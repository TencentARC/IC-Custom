[English](README.md) | **ç®€ä½“ä¸­æ–‡**

<div align="center">

<img alt="ic-custom" src="./assets/IC-Custom-Icon.png">

<br>

<p align="center">
  <a href="https://liyaowei-stu.github.io/project/IC_Custom/"><strong>é¡¹ç›®ä¸»é¡µ</strong></a> |
  <a href="https://arxiv.org/abs/2507.01926"><strong>è®ºæ–‡</strong></a> |
  <a href="https://huggingface.co/spaces/TencentARC/IC-Custom"><strong>åœ¨çº¿æ¼”ç¤º</strong></a> |
  <a href="https://huggingface.co/TencentARC/IC-Custom"><strong>æ¨¡å‹</strong></a> |
  <a href="https://www.youtube.com/watch?v=uaiZA3H5RVY"><strong>ä»‹ç»è§†é¢‘</strong></a>
</p>
</div>


## ğŸ“‹ æ¦‚è¿°

IC-Custom é¢å‘å¤šæ ·åŒ–çš„å›¾åƒå®šåˆ¶åœºæ™¯ï¼ŒåŒ…æ‹¬ï¼š

- **ä½ç½®æ„ŸçŸ¥æ¨¡å¼ (è¾“å…¥å‚è€ƒå›¾ã€ç›®æ ‡å›¾å’Œé®ç½©ï¼‰**ï¼š
  - è¾“å…¥å‚è€ƒå›¾ã€ç›®æ ‡èƒŒæ™¯ï¼Œå¹¶é€šè¿‡åˆ†å‰²æˆ–æ¶‚æŠ¹æŒ‡å®šå®šåˆ¶ä½ç½®ã€‚
  - ç¤ºä¾‹ï¼šå•†å“æ‘†æ”¾ã€è™šæ‹Ÿè¯•ç©¿

- **æ— ä½ç½®æ¨¡å¼ï¼ˆæ— è¾“å…¥é®ç½©ï¼‰**ï¼š
  - è¾“å…¥å‚è€ƒå›¾ä¸æ–‡å­—æè¿°ï¼Œç”Ÿæˆä¿æŒå‚è€ƒ ID çš„æ–°å›¾åƒã€‚
  - ç¤ºä¾‹ï¼šIP å®šåˆ¶ä¸åˆ›ä½œ

<p align="center">
  <img src="assets/teaser-github.jpeg" alt="IC-Custom Teaser" width="80%">
</p>

---

## âœ¨ è¯´æ˜

- å½“å‰ä¸º IC-Custom çš„**é¦–æ¬¡å‘å¸ƒ**ï¼ˆç‰ˆæœ¬ 0x1561ï¼‰ã€‚  
- æ¨¡å‹åœ¨**é®ç½©å¼å®šåˆ¶**æ–¹é¢è¡¨ç°æ›´å¼ºï¼Œå°¤å…¶é€‚åˆ**åŒ…è¢‹ã€é¦™æ°´ã€æœé¥°åŠå…¶ä»–åˆšæ€§ç‰©ä½“**ã€‚  
- è®­ç»ƒæ•°æ®ä¿è¯æ¸…æ™°åº¦ï¼ˆâ‰¥800pxï¼‰ï¼Œä½†è§„æ¨¡ä¸å¤šæ ·æ€§ä»æœ‰é™ï¼›æš‚ä¸åŒ…å«äººè„¸ç›¸å…³æ•°æ®ä¸å®Œæ•´é£æ ¼è¿ç§»ã€‚  
- **æ— é®ç½©å®šåˆ¶**ï¼ˆIP å®šåˆ¶ï¼‰ä¸äººè„¸ç­‰èƒ½åŠ›ä»åœ¨æŒç»­ä¼˜åŒ–ï¼Œæ¬¢è¿ç¤¾åŒºåé¦ˆã€‚  
- æ­£åœ¨æ¢ç´¢**åŠ é€Ÿ**ï¼ˆé‡åŒ–ã€è’¸é¦ï¼‰ä¸æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼ˆå¦‚äº§å“å®šåˆ¶åŒ–è§†è§’ï¼‰ã€‚  

**èµ„æº**

- **ComfyUI**ï¼š [ComfyUI_RH_ICCustom](https://github.com/HM-RunningHub/ComfyUI_RH_ICCustom)  
- **RunningHub**ï¼š
  - **è§†é¢‘**ï¼š [T8star-Aix ComfyUI æ¼”ç¤ºï¼ˆBilibiliï¼‰](https://www.bilibili.com/video/BV17gaCz7EWM/?spm_id_from=333.337.search-card.all.click&vd_source=b08a459ef4b115fe7614b270fe47627a)  
  - [IC Custom è§’è‰²+åœºæ™¯è¿ç§» V1](https://www.runninghub.cn/post/1963310792110215170/?inviteCode=rh-v1121)  
  - [IC Custom ä¸‡ç‰©è¿ç§» åŒå›¾å‚è€ƒ V1](https://www.runninghub.cn/post/1963304787548811266/?inviteCode=rh-v1121)  
  - [IC Custom æ¢è£…è¿ç§» V1](https://www.runninghub.cn/post/1963310832354562049/?inviteCode=rh-v1121)  
  - [IC Custom ä¸‡ç‰©è¿ç§» å•å›¾å‚è€ƒ V1](https://www.runninghub.cn/post/1963307022995402753/?inviteCode=rh-v1121)  

è‡´è°¢ï¼šComfyUI éƒ¨ç½²ç”± [HM-RunningHub](https://github.com/HM-RunningHub) æä¾›æ”¯æŒï¼›RunningHub å·¥ä½œæµç”± [T8star-Aix](https://www.runninghub.cn/user-center/1819214514410942465) è´¡çŒ®ã€‚  

---

## ğŸ“‘ ç›®å½•
- [ğŸ“‹ æ¦‚è¿°](#-æ¦‚è¿°)
- [âœ¨ è¯´æ˜](#-è¯´æ˜)
- [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [ğŸš€ ç¯å¢ƒä¾èµ–](#-ç¯å¢ƒä¾èµ–)
- [ğŸ”§ å®‰è£…](#-å®‰è£…)
- [ğŸ“¦ æ¨¡å‹æ£€æŸ¥ç‚¹](#-æ¨¡å‹æ£€æŸ¥ç‚¹)
- [ğŸ’» è¿è¡Œè„šæœ¬](#-è¿è¡Œè„šæœ¬)
  - [åº”ç”¨ï¼ˆGradio ç•Œé¢ï¼‰](#åº”ç”¨gradio-ç•Œé¢)
  - [æ¨ç†](#æ¨ç†)
- [ğŸ“… æ›´æ–°æ—¥å¿—](#-æ›´æ–°æ—¥å¿—)
- [ğŸ“ å¼•ç”¨](#-å¼•ç”¨)
- [ğŸ’– è‡´è°¢](#-è‡´è°¢)
- [é™åˆ¶](#é™åˆ¶)
- [ğŸ“„ è®¸å¯è¯](#-è®¸å¯è¯)
- [ğŸ“¬ è”ç³»æ–¹å¼](#-è”ç³»æ–¹å¼)
- [ğŸŒŸ Star å†å²](#-star-å†å²)

---

## ğŸš€ ç¯å¢ƒä¾èµ–

IC-Custom åœ¨ä»¥ä¸‹ç¯å¢ƒä¸­å®ç°å¹¶æµ‹è¯•ï¼š
- CUDA 12.4
- PyTorch 2.6.0
- Python 3.10.16

## ğŸ”§ å®‰è£…

1. å…‹éš†ä»“åº“
   ```bash
   git clone https://github.com/TencentARC/IC-Custom.git
   cd IC-Custom
   ```

2. é…ç½® Python ç¯å¢ƒ
   ```bash
   conda create -n ic-custom python=3.10 -y
   conda activate ic-custom
   pip install -e .
   pip install -r requirements.txt
   ```

3. è‡ªå®šä¹‰ CUDA ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰
   è‹¥éœ€å…¶ä»– CUDA ç‰ˆæœ¬ï¼Œå¯å¿½ç•¥ `requirements.txt` ä¸­ä¸ torch ç›¸å…³çš„åŒ…ï¼Œè½¬è€Œæ ¹æ® [PyTorch å®˜æ–¹ç½‘ç«™](https://pytorch.org/get-started/previous-versions/) æŒ‡å¼•å®‰è£…ä¸ä½  CUDA ç‰ˆæœ¬å…¼å®¹çš„ PyTorch ä¸ xformersã€‚
   
   CUDA 12.4 ç¤ºä¾‹ï¼š
   ```bash
   pip3 install xformers torch==2.5.0 torchvision==0.20.0 torchaudio==2.5.0 --index-url https://download.pytorch.org/whl/cu124
   ```

4. Flash Attention 2ï¼ˆå¯é€‰ï¼‰
   è‹¥è®¾å¤‡æ”¯æŒ Flash Attention 2ï¼Œå¯é€‰è£… flash-attnã€‚æˆ‘ä»¬ä½¿ç”¨ flash-attn==2.7.3ã€‚å…¼å®¹ç‰ˆæœ¬è§ [flash-attention releases](https://github.com/Dao-AILab/flash-attention/releases)ã€‚

## ğŸ“¦ æ¨¡å‹æ£€æŸ¥ç‚¹

åœ¨è¿è¡Œåº”ç”¨æˆ–æ¨ç†å‰ï¼Œéœ€è¦è·å–æ¨¡å‹æ£€æŸ¥ç‚¹ï¼š

- æ–¹å¼ä¸€ â€” è„šæœ¬è‡ªåŠ¨ä¸‹è½½ï¼ˆéœ€æœ‰æ•ˆçš„ `HF_TOKEN`ï¼‰
- æ–¹å¼äºŒ â€” æ‰‹åŠ¨ä¸‹è½½ï¼šä½¿ç”¨è¾…åŠ©è„šæœ¬åï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æœ¬åœ°è·¯å¾„

```bash
sh scripts/inference/download_models.sh $HF_TOKEN
```

æœŸæœ›çš„ç›®å½•ç»“æ„ï¼ˆç¤ºä¾‹ï¼‰ï¼š
```
|-- models
    |-- clip-vit-large-patch14
    |-- ic-custom
    |   |-- dit_boundary_embeddings_0x1561.safetensors
    |   |-- dit_lora_0x1561.safetensors
    |   |-- dit_task_register_embeddings_0x1561.safetensors
    |   |-- dit_txt_img_in_0x1561.safetensors
    |   ...
    |-- siglip-so400m-patch14-384
    |-- t5-v1_1-xxl
    |-- ae.safetensors
    |-- flux1-fill-dev.safetensors
    |-- flux1-redux-dev.safetensors
```

æ‰‹åŠ¨ä¸‹è½½åï¼Œè¯·ä¿®æ”¹ `configs/**` ä¸‹çš„ YAMLï¼ˆå¦‚ [`inference.yaml`](configs/inference/inference.yaml)ï¼‰ä»¥æŒ‡å‘æœ¬åœ°æ¨¡å‹è·¯å¾„ã€‚

- å„æ¨¡å‹çš„ç²¾ç®€é“¾æ¥æ¸…å•è§ [`MODEL_CARD.md`](MODEL_CARD.md)ã€‚

## ğŸ’» è¿è¡Œè„šæœ¬

### åº”ç”¨ï¼ˆGradio ç•Œé¢ï¼‰

è¿è¡Œåº”ç”¨æ—¶ï¼Œ**å¿…é¡»çš„æ¨¡å‹ä¼šè‡ªåŠ¨ä¸‹è½½**ï¼›å¯é€‰æ¨¡å‹ä»…åœ¨æ˜¾å¼å¯ç”¨æ—¶ä¸‹è½½ã€‚

```bash
sh src/app/run_app.sh $HF_TOKEN $HF_CACHE_DIR
```

å…³äºå¿…é€‰/å¯é€‰æ¨¡å‹ä¸é…ç½®ï¼Œè§ [APP.md](src/app/APP.md)ã€‚

### æ¨ç†

ä½¿ç”¨ Hugging Face Token è¿è¡Œæ¨ç†è„šæœ¬ï¼š

```bash
sh scripts/inference/inference.sh $HF_TOKEN $HF_CACHE_DIR
```

å‚æ•°ï¼š
- `$HF_TOKEN`ï¼šHugging Face è®¿é—®ä»¤ç‰Œï¼ˆç”¨äºè‡ªåŠ¨ä¸‹è½½æ¨¡å‹ï¼›è‹¥åœ¨ `configs/**/*.yaml` ä¸­å·²æŒ‡å®šæœ¬åœ°è·¯å¾„ï¼Œåˆ™å¯é€‰ï¼‰
- `$HF_CACHE_DIR`ï¼ˆå¯é€‰ï¼‰ï¼šè‡ªå®šä¹‰æ¨¡å‹ç¼“å­˜ç›®å½•ï¼ˆé»˜è®¤ï¼š"~/.cache/huggingface/hub"ï¼‰

## ğŸ“… æ›´æ–°æ—¥å¿—

- [X] **2025/07/03** - è®ºæ–‡ä¸ç½‘é¡µå‘å¸ƒ
- [X] **2025/08/26** - å‘å¸ƒæ£€æŸ¥ç‚¹ v0x1561ã€åº”ç”¨ä¸æ¨ç†ä»£ç 
- [ ] **TBD** - æµ‹è¯•ä¸è®­ç»ƒä»£ç 
- [ ] **TBD** - æ›´å¼ºæ¨¡å‹ç‰ˆæœ¬

## ğŸ“ å¼•ç”¨

```bibtex
@article{li2025ic,
  title={IC-Custom: Diverse Image Customization via In-Context Learning},
  author={Li, Yaowei and Li, Xiaoyu and Zhang, Zhaoyang and Bian, Yuxuan and Liu, Gan and Li, Xinyuan and Xu, Jiale and Hu, Wenbo and Liu, Yating and Li, Lingen and others},
  journal={arXiv preprint arXiv:2507.01926},
  year={2025}
}
```

## ğŸ’– è‡´è°¢

æˆ‘ä»¬æ„Ÿè°¢ä»¥ä¸‹ä»£ç åº“ï¼š
- [flux](https://github.com/black-forest-labs/flux)
- [x-flux](https://github.com/XLabs-AI/x-flux/releases)

åŒæ—¶æ„Ÿè°¢ [Hugging Face](https://huggingface.co/) æä¾›çš„æ¨¡å‹æ‰˜ç®¡ä¸ Spaces éƒ¨ç½²æ”¯æŒã€‚


## é™åˆ¶
å½“å‰é™åˆ¶ä¸»è¦åœ¨æ¨ç†é€Ÿåº¦ä¸æ›´çµæ´»çš„æŒ‡ä»¤è·Ÿéšæ–¹é¢ã€‚æˆ‘ä»¬å°†æŒç»­æ”¹è¿›ã€‚å¦‚æœ‰å»ºè®®ï¼Œæ¬¢è¿åé¦ˆã€‚


## ğŸ“„ è®¸å¯è¯

æˆ‘ä»¬æ”¯æŒå¼€æºç¤¾åŒºã€‚å®Œæ•´ç»†èŠ‚è§ [LICENSE](LICENSE) ä¸ [NOTICE](NOTICE)ã€‚

## ğŸ“¬ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿é€šè¿‡ [email](mailto:liyaowei01@gmail.com) è”ç³»æˆ‘ä»¬ã€‚


## ğŸŒŸ Star å†å²

<p align="center">
    <a href="https://star-history.com/#TencentARC/IC-Custom" target="_blank">
        <img width="500" src="https://api.star-history.com/svg?repos=TencentARC/IC-Custom&type=Date" alt="Star History Chart">
    </a>
</p>


